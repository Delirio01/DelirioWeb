<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Particle System Test</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: system-ui;
      background: #000;
      color: #fff;
    }
    #particle-container {
      width: 600px;
      height: 600px;
      border: 2px solid #FF6B35;
      background: rgba(255, 107, 53, 0.05);
    }
    .info {
      margin: 20px 0;
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>üîç Particle System Debug Test</h1>
  
  <div class="info">
    <h2>System Info:</h2>
    <div id="webgl-info"></div>
  </div>

  <div class="info">
    <h2>Console Output:</h2>
    <div id="console-output" style="font-family: monospace; font-size: 12px;"></div>
  </div>

  <h2>Particle Container (600x600):</h2>
  <div id="particle-container"></div>

  <script type="module">
    // Capture console logs
    const consoleOutput = document.getElementById('console-output');
    const originalLog = console.log;
    const originalError = console.error;
    
    function addLog(type, ...args) {
      const line = document.createElement('div');
      line.style.color = type === 'error' ? '#ff6b6b' : '#4ecdc4';
      line.textContent = `[${type}] ${args.join(' ')}`;
      consoleOutput.appendChild(line);
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    }
    
    console.log = function(...args) {
      originalLog.apply(console, args);
      addLog('log', ...args);
    };
    
    console.error = function(...args) {
      originalError.apply(console, args);
      addLog('error', ...args);
    };

    // WebGL detection
    const webglInfo = document.getElementById('webgl-info');
    
    try {
      const canvas = document.createElement('canvas');
      const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
      
      if (!gl) {
        webglInfo.innerHTML = '<p style="color: #ff6b6b;">‚ùå WebGL NOT supported</p>';
      } else {
        const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
        let renderer = 'Unknown';
        let vendor = 'Unknown';
        
        if (debugInfo) {
          vendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);
          renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
        }
        
        webglInfo.innerHTML = `
          <p style="color: #4ecdc4;">‚úÖ WebGL IS supported</p>
          <p><strong>Vendor:</strong> ${vendor}</p>
          <p><strong>Renderer:</strong> ${renderer}</p>
          <p><strong>WebGL Version:</strong> ${gl.getParameter(gl.VERSION)}</p>
          <p><strong>Is Software Renderer:</strong> ${renderer.includes('SwiftShader') || renderer.includes('llvmpipe') ? 'YES ‚ö†Ô∏è' : 'NO ‚úÖ'}</p>
        `;
      }
    } catch (e) {
      webglInfo.innerHTML = `<p style="color: #ff6b6b;">‚ùå Error checking WebGL: ${e.message}</p>`;
    }

    // Import Three.js
    console.log('Importing Three.js...');
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';
    
    console.log('Three.js imported successfully');
    console.log('Starting particle system initialization...');

    // Simple Three.js test
    const container = document.getElementById('particle-container');
    
    try {
      console.log('Creating scene...');
      const scene = new THREE.Scene();
      
      console.log('Creating camera...');
      const camera = new THREE.PerspectiveCamera(
        75,
        container.clientWidth / container.clientHeight,
        0.1,
        1000
      );
      camera.position.z = 35;
      
      console.log('Creating renderer...');
      const renderer = new THREE.WebGLRenderer({ 
        antialias: true, 
        alpha: true,
        failIfMajorPerformanceCaveat: false
      });
      
      renderer.setClearColor(0x000000, 0);
      renderer.setSize(container.clientWidth, container.clientHeight);
      container.appendChild(renderer.domElement);
      
      console.log('‚úÖ Renderer created!');
      console.log('Canvas dimensions:', renderer.domElement.width, 'x', renderer.domElement.height);
      
      // Create a simple test particle
      console.log('Creating test particles...');
      const particleColor = new THREE.Color('#FF6B35');
      const geometry = new THREE.SphereGeometry(1, 16, 16);
      const material = new THREE.MeshBasicMaterial({ 
        color: particleColor,
        transparent: true,
        opacity: 0.8
      });
      
      // Create 50 test particles
      const particles = [];
      for (let i = 0; i < 50; i++) {
        const mesh = new THREE.Mesh(geometry, material);
        const angle = (i / 50) * Math.PI * 2;
        const radius = 15;
        mesh.position.set(
          Math.cos(angle) * radius,
          Math.sin(angle) * radius,
          (Math.random() - 0.5) * 10
        );
        scene.add(mesh);
        particles.push(mesh);
      }
      
      console.log(`‚úÖ Created ${particles.length} test particles`);
      
      // Animation loop
      let frame = 0;
      function animate() {
        frame++;
        
        if (frame % 60 === 0) {
          console.log(`Animation running... frame ${frame}`);
        }
        
        // Rotate particles
        particles.forEach((p, i) => {
          p.rotation.y += 0.01;
          p.position.y = Math.sin(Date.now() * 0.001 + i) * 2;
        });
        
        // Rotate camera slowly
        camera.position.x = Math.sin(Date.now() * 0.0005) * 10;
        camera.lookAt(0, 0, 0);
        
        renderer.render(scene, camera);
        requestAnimationFrame(animate);
      }
      
      console.log('üé¨ Starting animation loop...');
      animate();
      
    } catch (error) {
      console.error('‚ùå Error creating Three.js scene:', error);
      console.error('Error stack:', error.stack);
    }
  </script>
</body>
</html>
